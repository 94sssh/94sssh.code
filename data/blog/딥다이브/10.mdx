---
title: '[딥다이브] - 13. 스코프'
date: '2024-04-23T00:00:00'
tags: ['javascript', 'book', 'deepdive']
draft: false
summary: 13. 스코프
layout: PostSimple
---

## 13.1. 스코프란?

> 식별자가 유효한 범위

모든 식별자(변수명, 함수명, 클래스명 등)는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정되는데, 이를 **스코프**라 한다. 위치가 다른 두 변수를 각각 다른 위치에서 참조한 경우, 자바스크립트 엔진은 **스코프**를 통해 이름이 같은 두 변수 중 어떤 변수를 참조할지를 정한다. 이를 식별자 결정이라 한다.

## 13.2. 스코프의 종류

변수는 자신이 선언된 위치에 따라 **전역 스코프**를 갖는 전역 변수나, **지역 스코프**를 갖는 지역 변수로 나뉜다.

### 13.2.1. 전역과 전역 스코프

전역에 변수를 선언하면 **전역 스코프**를 갖는 전역 변수가 된다. 전역 변수는 어디서든지 참조할 수 있다.

### 13.2.2. 지역과 지역 스코프

지역이란 **함수 몸체 내부**로, 지역에 변수를 선언하면 **지역 스코프**를 갖는 지역 변수가 된다. 지역 변수는 자신이 선언된 지역과 하위 지역에서만 참조할 수 있다.

## 13.3. 스코프 체인

함수의 지역 스코프도 중첩될 수 있다. **스코프가 함수의 중첩에 의해 계층적 구조를 갖는 것**으로, 중첩 함수의 지역 스코프는 외부 함수의 지역 스코프와 계층적 구조를 갖는다. 외부 함수의 지역 스코프를 중첩 함수의 **상위 스코프**라 한다.

모든 스코프는 하나의 계층적 구조로 연결되며, 전역 스코프는 모든 지역 스코프의 최상위 스코프이다. 이렇게 스코프의 계층적 구조를 **스코프 체인**이라 한다.

자바스크립트 엔진은 코드를 실행하기 전, **렉시컬 환경**을 생성한다. 변수가 선언되면 변수 식별자가 렉시컬 환경에 키로 등록되고, 변수 할당이 일어나면 변수 식별자에 해당하는 값을 변경한다.

**렉시컬 환경**

> 스코프 체인은 실행 컨텍스트의 렉시컬 환경을 단방향으로 연결한 것. [실행 컨텍스트](https://94sssh-code.vercel.app/blog/%EB%94%A5%EB%8B%A4%EC%9D%B4%EB%B8%8C_23_%EC%8B%A4%ED%96%89_%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8#233-%EC%8B%A4%ED%96%89-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-%EC%97%AD%ED%95%A0)

### 13.3.1. 스코프 체인에 의한 변수 검색

자바스크립트 엔진은 **스코프 체인을 따라 변수를 참조하는 지역 스코프에서 시작해 상위 스코프로 이동**하며 변수를 검색한다. **상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만, 하위 스코프에서 유효한 변수는 상위 스코프에서 참조할 수 없다**.

## 13.4. 함수 레벨 스코프

**지역 스코프는 함수에 의해서만 생성된다.** 대부분의 프로그래밍 언어는 함수 몸체뿐 아니라 모든 코드 블록(`if`, `for`, `while`, `try/catch`)이 지역 스코프를 만드는 데, 이를 **블록 레벨 스코프**라 한다. `var` 키워드로 선언된 변수는 함수의 코드 블록만을 지역 스코프로 인정하는데, 이는 **함수 레벨 스코프**라 한다. 따라서, `var` 키워드로 선언된 변수는 함수 레벨 스코프만 인정하므로, 함수 밖에서 `var` 키워드로 선언된 변수는 코드 블록 내에서 선언되었어도 전역 변수이다. 이 때문에 `var` 키워드로 선언된 전역 변수는 의도치 않은 재할당이 이루어질 수 있다. ES6에서 도입된 `let`, `const`는 **블록 레벨 스코프**를 지원한다.

## 13.5. 렉시컬 스코프

```js
var fruit = 'orange'

function foo() {
  var fruit = 'apple'
  bar()
}

function bar() {
  console.log(fruit)
}

foo() // ?
bar() // ?
```

위 코드의 실행 결과는 `bar` 함수의 상위 스코프가 무엇인지에 따라 결정되는데, 두 가지 방식이 있다.

**함수를 어디서 호출**했는지에 따라 상위 스코프를 결정하는 **동적 스코프**와 **함수를 어디서 정의**했는지에 따라 상위 스코프를 결정하는 **렉시컬 스코프** 또는 **정적 스코프**가 있다. 자바스크립트를 비롯한 대부분의 프로그래밍 언어는 **렉시컬 스코프**를 따른다.

렉시컬 스코프는 함수를 어디서 정의했는지에 따라 함수 정의가 실행될 때 상위 스코프가 정적으로 결정되므로, 함수가 호출된 위치는 상위 스코프 결정에 어떠한 영향도 주지 않는다. 즉, **함수의 상위 스코프는 언제나 자신이 정의된 스코프**다.

위 코드의 실행 결과는 `bar` 함수는 전역 함수로 전역 스코프를 기억하여, 어디서 호출되건 전역 스코프를 상위 스코프로 사용한다. 위 예제는 전역 변수 `fruit`의 값 "orange"를 두 번 출력한다.
