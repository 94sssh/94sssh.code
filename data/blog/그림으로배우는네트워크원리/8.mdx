---
title: '[네트워크 원리] - 06. 라우팅(1)'
date: '2024-09-22T00:00:00'
tags: ['그림으로배우는네트워크원리', 'book', 'network']
draft: false
summary: 06. 라우팅(1)
layout: PostSimple
---

## 라우팅

### 외부 네트워크로 데이터를 보낸다

다른 네트워크로 데이터를 보내려면 라우터로 전송해야 함.  
라우터는 데이터의 목적지가 접속해 있는 네트워크의 라우터로 전송(라우팅)  
라우팅을 반복해 멀리 떨어진 네트워크로도 데이터를 보낼 수 있다.

라우터가 전송하는 데이터는 IP 패킷으로 인터넷층에 속한다. IP 헤더 안의 목적지 IP 주소를 확인 후, IP 헤더의 TTL과 헤더 체크섬만 변경되고, 나머지는 변경되지 않은 채로 전송된다.  
이더넷 헤더 등 네트워크 인터페이스층 프로토콜의 헤더는 라우터가 전송할 때 완전히 새로운 헤더로 교체된다.

### 라우터로 네트워크 연결에 필요한 주소 설정

IP 주소 설정: 네트워크에 접속하는 것  
라우터는 복수의 인터페이스가 있으므로, 물리적인 배선과 IP 주소 설정을 각각 해야 함.

### 데이터의 전송치를 결정한다

라우터의 데이터 전송 흐름

1. 라우팅 대상인 IP 패킷 수신  
   라우터가 라우팅하는 대상인 IP 패킷은 다음과 같은 주소 정보의 패킷
   - 목적지 레이어2 주소(MAC 주소): 라우터
   - 목적지 IP 주소: 라우터의 IP 주소 이외
2. 경로 정보를 검색해 전송할 곳 결정  
   목적지 IP 주소로 라우팅 테이블의 경로를 탐색

넥스트 홉: 다음에 전송할 라우터

### 다음 라우터로 데이터를 전송한다

넥스트 홉으로 전송하기 위해 새로운 헤더를 추가한다.  
이더넷에서는 MAC 주소를 구하기 위해 ARP를 실행하고, MAC 주소를 알아내면 새로운 이더넷 헤더로 바꾼 후 IP 패킷을 인터페이스2에서 전송
레이어2 헤더인 이더넷 헤더는 완전히 새로워지지만, IP 헤더의 IP 주소는 달라지지 않음, IP 헤더의 TTL을 -1하고, 헤더 체크섬을 다시 계산
라우터에서 NAT로 IP 주소를 변환할 때는 IP 주소가 바뀐지만, 단순한 라우팅은 IP 주소가 달라지지 않음

### 최종 주소를 확인한다

라우팅 처리는 라우터마다 하고, 최종 목적지에 접속한 라우터까지 IP 패킷이 전송되어 간다.

### 목적지로 데이터를 보낸다

데이터가 도착하면 응답을 반환한다.  
통신은 양방향이기 때문.

### 라우터가 인식하는 네트워크 정보

라우팅 테이블에는 어떤 네트워크로 IP 패킷을 전송하기 위한 경로(다음에 전송해야 하는 라우터)가 등록되어 있음  
라우팅 테이블에 등록된 네트워크 정보를 루트 정보나 경로 정보라고 부름

경로 정보에서 중요한건 목적지의 `네트워크주소/서브넷마스크와 넥스트 홉 주소`

라우터는 라우팅 테이블로 이웃 라우터의 네트워크 구성을 인식하는데, 연결된 네트워크로 전송을 반복해 가기 때문에 이웃 라우터까지만 전송할 수 있으면 되므로 네트워크 전체의 구성이 아닌 이웃 라우터 너머의 수준을 인식한다.  
그러므로, 라우팅 테이블 상에서 인식할 수 없는 네트워크로 가는 IP 패킷은 모두 폐기된다.

### 라우팅 테이블의 가장 기본적인 정보

라우팅 테이블에 경로 정보를 등록하는 3가지 방법

1. 직접 접속
2. 스태틱 라우팅
3. 라우팅 프로토콜

- 직접 접속  
   경로 정보를 라우팅 테이블에 등록하기 위한 특별한 설정은 필요 없음  
  라우터의 인터페이스에 IP 주소를 설정하고 활성화하면 자동으로 IP 주소에 대응하는 네트워크 주소의 경로 정보가 직접 접속의 경로 정보로 라우팅 테이블에 등록

### 직접 접속되지 않은 경로 정보를 등록하는 방법

- 스태틱 라우팅  
   라우터에 커맨드를 입력하는 등 경로 정보를 수동으로 등록

- 라우팅 프로토콜  
   라우터에서 라우팅 프로토콜을 활성화하면, 라우터끼리 정보를 교환해 라우팅 테이블에 필요한 경로 정보를 등록해 줌

주요 라우팅 프로토콜

| 이름                              | 개요                     |
| --------------------------------- | ------------------------ |
| RIP(Routing Information Protocol) | 소규모 네트워크          |
| OSPF(Open Shortest Path First)    | 중규모 ~ 대규모 네트워크 |
| BGP(Border Gateway Protocol)      | 인터넷 백본              |
